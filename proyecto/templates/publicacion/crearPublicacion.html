{% extends "base.html" %}
{% load static %}
{% block links %}
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&amp;display=swap">
    <link rel="stylesheet" href="{% static 'assets/css/Fully-responsive-table.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/Table-with-Vertical-Alignment.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/styleCrearPublicaciones.css' %}">
{% endblock links %}

{% block title %}
    <title>Comparte tu experiencia</title>
{% endblock title %}

{% block content %}
<section class="py-5">
    <div class="container py-5">
        <div class="row d-flex justify-content-center form-container">
            <div class="col-12 col-lg-6 form-col">
                <div class="d-flex flex-column">
                    {% for error in form.non_field_errors %}
                    <div class="alert alert-danger" role="alert">
                        {{ error }}
                    </div>          
                    {% endfor %}
                    <form class="d-flex flex-column experiencia-form" method="post">
                        {% csrf_token %}
                        <div>
                            <h1 class="form-title"><strong>¡Comparte tu experiencia!</strong></h1>
                            <div class="d-flex flex-column media profesor-info">
                                <div class="d-flex">
                                    <div class="d-flex flex-column align-items-start">
                                        <p class="text-muted profesor-label"><span class="profesor-span">Profesor</span><br></p>
                                        <h4 id="SeleccionnombreProfesor-id" name="nombreProfesor"><strong>Selecciona un profesor</strong></h4>
                                        <!-- Input del nombre del profesor que rescata el nombre del profesor seleccionado -->
                                        <input class="form-control" type="text" id="nombreProfesor-id" name="profesor" required hidden value="0">
                                        {% for error in form.profesor.errors %}
                                            <p style="color: #ff5555">{{ error }}</p>
                                        {% endfor %}
                                        <a href="#" class="profesor-link" data-bs-toggle="modal" data-bs-target="#profesorModal">Cambiar profesor</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                            <label class="form-label" for="titulo-id">Título de la publicación</label>
                            <input class="form-control" type="text" id="titulo-id" name="titulo">
                            {% for error in form.titulo.errors %}
                               <p style="color: #ff5555">{{ error }}</p>
                            {% endfor %}
                            <label class="form-label" for="materia-id">Nombre de la materia</label>
                            <div class="d-flex justify-content-between align-items-baseline">
                                <p id="materiaSeleccionada-id" name="materia">Selecciona una materia</p>
                                <input class="form-control" type="text" id="materia-id" name="materia" required for="id_materia-id" value="0" hidden>
                                {% for error in form.materia.errors %}
                                    <p style="color: #ff5555">{{ error }}</p>
                                {% endfor %}
                                <a href="#" class="materia-link" data-bs-toggle="modal" data-bs-target="#materiaModal">Buscar materia</a>                
                            </div>                       
                            <label class="form-label" id="calificaProfesorId" >Califica al profesor</label>
                            <div class="d-flex justify-content-start align-items-baseline"></div>
                            <div class="d-flex justify-content-between align-items-baseline calificacion-group">
                                <p for="dominio-id" class="calificacion-item-label">Dominio de la materia</p>
                                <select id="dominio-id" title="Dominio" class="form-select calificacion-select" name="dominio">
                                    <optgroup label="Calificación">
                                        <option value="10" selected>10</option>
                                        <option value="9">9</option>
                                        <option value="8">8</option>
                                        <option value="7">7</option>
                                        <option value="6">6</option>
                                        <option value="5">5</option>
                                        <option value="4">4</option>
                                        <option value="3">3</option>
                                        <option value="2">2</option>
                                        <option value="1">1</option>
                                        <option value="0">0</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="d-flex justify-content-between align-items-baseline calificacion-group">
                                <p for="publicacion-id" class="calificacion-item-label">Puntualidad</p>
                                <select id="publicacion-id" title="Puntualidad" class="form-select calificacion-select"  name="puntualidad">
                                    <optgroup label="Calificación">
                                        <option value="10" selected>10</option>
                                        <option value="9">9</option>
                                        <option value="8">8</option>
                                        <option value="7">7</option>
                                        <option value="6">6</option>
                                        <option value="5">5</option>
                                        <option value="4">4</option>
                                        <option value="3">3</option>
                                        <option value="2">2</option>
                                        <option value="1">1</option>
                                        <option value="0">0</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="d-flex justify-content-between align-items-baseline calificacion-group">
                                <p for="asistencia-id" class="calificacion-item-label">Asistencia</p>
                                <select id="asistencia-id" title="Asistencia" class="form-select calificacion-select" name="asistencia">
                                    <optgroup label="Calificación">
                                        <option value="10" selected>10</option>
                                        <option value="9">9</option>
                                        <option value="8">8</option>
                                        <option value="7">7</option>
                                        <option value="6">6</option>
                                        <option value="5">5</option>
                                        <option value="4">4</option>
                                        <option value="3">3</option>
                                        <option value="2">2</option>
                                        <option value="1">1</option>
                                        <option value="0">0</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="d-flex justify-content-between align-items-baseline calificacion-group">
                                <p for="dificultad-id" class="calificacion-item-label">Dificultad</p>
                                <select id="dificultad-id" title="Dificultad" class="form-select calificacion-select" name="dificultad" title="Calificación de dificultad">
                                    <optgroup label="Calificación">
                                        <option value="10" selected>10</option>
                                        <option value="9">9</option>
                                        <option value="8">8</option>
                                        <option value="7">7</option>
                                        <option value="6">6</option>
                                        <option value="5">5</option>
                                        <option value="4">4</option>
                                        <option value="3">3</option>
                                        <option value="2">2</option>
                                        <option value="1">1</option>
                                        <option value="0">0</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="d-flex justify-content-between align-items-baseline calificacion-group">
                                <p for="seguimiento-id" class="calificacion-item-label">Seguimiento</p>
                                <select id="seguimiento-id" title="Seguimiento" class="form-select calificacion-select" id="calificacioSeguimientoId" name="seguimiento">
                                    <optgroup label="Calificación">
                                        <option value="10" selected>10</option>
                                        <option value="9">9</option>
                                        <option value="8">8</option>
                                        <option value="7">7</option>
                                        <option value="6">6</option>
                                        <option value="5">5</option>
                                        <option value="4">4</option>
                                        <option value="3">3</option>
                                        <option value="2">2</option>
                                        <option value="1">1</option>
                                        <option value="0">0</option>
                                    </optgroup>
                                </select>
                            </div>
                            <label for="comentario-id" class="form-label comentarios-label">Comentarios</label>
                            <textarea id="comentario-id" class="form-control comentarios" name="comentario" placeholder="Puedes añadir cualquier comentario que sea de interés respecto al profesor" rows="5" style="resize: none;"></textarea>
                            {% for error in form.comentario.errors %}
                                <p class="errores-formulario">{{ error }}</p>
                            {% endfor %}
                            <!-- Borrar todo -->
                            <div class="d-flex justify-content-end align-items-center">
                                <button class="btn " type="reset">Borrar todo</button>
                            </div>
                            <button class="btn btn-primary submit-btn" type="submit"><strong>Crear publicación</strong></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Modal para mostrar todos los profesores -->
    <div class="modal fade" id="profesorModal" tabindex="-1" aria-labelledby="profesorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profesorModalLabel">Selecciona un profesor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="searchProfesor" onkeyup="filterProfesores()" placeholder="Buscar profesor..." class="form-control mb-3">
                    <ul id="profesorList" class="list-group">
                        {% for profesor in profesores %}
                            <li class="list-group-item list-group-item-action" onclick="selectProfesor('{{ profesor.id }}', '{{ profesor.nombre }}')">{{ profesor.nombre }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal para mostrar todas las materias -->
    <div class="modal fade" id="materiaModal" tabindex="-1" aria-labelledby="materiaModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="materiaModalLabel">Selecciona una materia</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="searchmateria" onkeyup="filtermaterias()" placeholder="Buscar materia..." class="form-control mb-3">
                    <ul id="materiaList" class="list-group">
                        {% for materia in materias %}
                            <li class="list-group-item list-group-item-action" onclick="selectmateria('{{ materia.id }}', '{{ materia.nombre }}')"> {{materia.clave}} - {{ materia.nombre }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script>
        function selectProfesor(id, nombre) {
            document.getElementById('nombreProfesor-id').value = nombre;
            document.getElementById('SeleccionnombreProfesor-id').innerText = nombre;

            // Cierra el modal
            var profesorModalElement = document.getElementById('profesorModal');
            var profesorModal = bootstrap.Modal.getInstance(profesorModalElement);
            profesorModal.hide(); // Cierra el modal
        }
        function filterProfesores() {
            let input = document.getElementById('searchProfesor');
            let filter = input.value.toLowerCase();
            let ul = document.getElementById('profesorList');
            let li = ul.getElementsByTagName('li');
    
            for (let i = 0; i < li.length; i++) {
                let txtValue = li[i].textContent || li[i].innerText;
                if (txtValue.toLowerCase().indexOf(filter) > -1) {
                    li[i].style.display = "";
                } else {
                    li[i].style.display = "none";
                }
            }
        }
        function selectmateria(id, nombre) {
            document.getElementById('materia-id').value = nombre;
            document.getElementById('materiaSeleccionada-id').innerText = nombre;
            // Cierra el modal
            var materiaModalElement = document.getElementById('materiaModal');
            var materiaModal = bootstrap.Modal.getInstance(materiaModalElement);
            materiaModal.hide(); // Cierra el modal
        }
        function filtermaterias() {
            let input = document.getElementById('searchmateria');
            let filter = input.value.toLowerCase();
            let ul = document.getElementById('materiaList');
            let li = ul.getElementsByTagName('li');
    
            for (let i = 0; i < li.length; i++) {
                let txtValue = li[i].textContent || li[i].innerText;
                if (txtValue.toLowerCase().indexOf(filter) > -1) {
                    li[i].style.display = "";
                } else {
                    li[i].style.display = "none";
                }
            }
        }
        //Aqui empieza 
        
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
{% endblock content %}
